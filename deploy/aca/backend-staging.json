{
  "name": "hedge-backend-staging",
  "location": "East US 2",
  "properties": {
    "environmentId": "/subscriptions/739ed6b9-1da6-448e-9cbc-e8edccd4d6fd/resourceGroups/rg-alcast-hc-dev-eastus2/providers/Microsoft.App/managedEnvironments/alcast-hc-dev-aca-ri3hqwb6aal32",
    "configuration": {
      "ingress": {
        "external": true,
        "targetPort": 8000,
        "transport": "auto"
      },
      "registries": [
        {
          "server": "hedgecontrolacr.azurecr.io",
          "username": "${ACR_USERNAME}",
          "passwordSecretRef": "acr-password"
        }
      ],
      "secrets": [
        {
          "name": "acr-password",
          "value": "${ACR_PASSWORD}"
        }
      ]
    },
    "template": {
      "containers": [
        {
          "name": "hedge-backend",
          "image": "hedgecontrolacr.azurecr.io/hedge-backend:staging",
          "resources": {
            "cpu": 0.5,
            "memory": "1Gi"
          },
          "env": [
            {
              "name": "DATABASE_URL",
              "value": "${DATABASE_URL}"
            },
            {
              "name": "JWT_ISSUER",
              "value": "${JWT_ISSUER}"
            },
            {
              "name": "JWT_AUDIENCE",
              "value": "${JWT_AUDIENCE}"
            },
            {
              "name": "JWKS_URL",
              "value": "${JWKS_URL}"
            }
          ]
        }
      ],
      "scale": {
        "minReplicas": 1,
        "maxReplicas": 3,
        "rules": [
          {
            "name": "http-scale",
            "http": {
              "metadata": {
                "concurrentRequests": "50"
              }
            }
          }
        ]
      }
    }
  }
}